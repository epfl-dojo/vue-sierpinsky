<html>
  <head>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.0/jquery.js"></script>
      <script src="jquery.svg.min.js"></script>
      <script src="jquery.svgdom.min.js"></script>
      <title>Sierpinsky</title>
  </head>
<body>
   <h1> Sierpinsky</h1>
    <div id="app">
      <button onclick="javascript:startOver()">startOver()!</button>
      <button onclick="javascript:window.sierpinskifyAll();">sierpinskify all the polygons!</button>
      <br />
      <svg width="800" height="800">
      </svg>
    </div>
  <script>
    window.initTriangle = function initTriangle(polygon) {
        var topx = Number($(polygon).attr("data-x"));
        var topy = Number($(polygon).attr("data-y"));
        var size = Number($(polygon).attr("data-size"));
        function pointA() {
                  var ax, ay;
                  ax=topx;
                  ay=topy+size;
                  return "" + ax + "," + ay;
              };
        function pointB() {
                  var ax, ay;
                  ax=topx+size;
                  ay=topy+size;
                  return "" + ax + "," + ay;
              };
        function pointC() {
                  var ax, ay;
                  ax=topx+(size/2);
                  ay=topy;
                  return "" + ax + "," + ay;
              };

        $(polygon).attr("points", pointA() + " " + pointB() + " " + pointC());
      }

      function initTriangles() {
        $('polygon').each(function(i, poly) { initTriangle(poly); });
      }

      function sierpinskified(polygon)  {
        var topx = Number($(polygon).attr("data-x"));
        var topy = Number($(polygon).attr("data-y"));
        var size = Number($(polygon).attr("data-size"));
          //$(polygon).html(
          return $(
            ("<polygon style=\"fill:lime;stroke:purple;stroke-width:1\" data-x=\"{{DX1}}\" data-y=\"{{DY1}}\" data-size=\"{{SZ1}}\"></polygon>" +
            "<polygon style=\"fill:lime;stroke:purple;stroke-width:1\" data-x=\"{{DX2}}\" data-y=\"{{DY2}}\" data-size=\"{{SZ2}}\"></polygon>" +
            "<polygon style=\"fill:lime;stroke:purple;stroke-width:1\" data-x=\"{{DX3}}\" data-y=\"{{DY3}}\" data-size=\"{{SZ3}}\"></polygon>")
            .replace("{{DX1}}", topx + size/4)
            .replace("{{DY1}}", topy)
            .replace("{{SZ1}}", size/2)
            .replace("{{DX2}}", topx)
            .replace("{{DY2}}", topy + size/2)
            .replace("{{SZ2}}", size/2)
            .replace("{{DX3}}", topx + size/2)
            .replace("{{DY3}}", topy + size/2)
            .replace("{{SZ3}}", size/2)
          ).toArray();
      }
      window.sierpinskifyAll = function() {
        var newPolygons = $('polygon').map(function(i, poly) {
          return sierpinskified(poly);
        });

        $("svg").empty().append(newPolygons);
        initTriangles();
        // But! The nodes were created in the wrong namespace.
        // Fortunately! http://stackoverflow.com/a/13654655
        $("div#app").html($("div#app").html());
      }
      window.startOver = function() {
        $("svg").html('<polygon style="fill:lime;stroke:purple;stroke-width:1" data-x="10" data-y="10" data-size="700"></polygon>');
        initTriangles();
        $("div#app").html($("div#app").html());
      }
  </script>
  <script dojo-comment="A effacer a la fin">
    $(function() {
      startOver();
    })
  </script>
</body>
</html>
